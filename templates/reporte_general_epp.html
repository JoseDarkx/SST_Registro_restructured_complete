<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reporte General de EPP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="..//static/css/reporte_general_epp.css">
</head>
<body>
 <div class="sidebar">
    <h2>SST-AnalyTIC</h2>
    <ul>
        <li><a href="/dashboard" class="menu-link">Inicio</a></li>

        <li class="section-title">GESTIÓN PRINCIPAL</li>
        <li><a href="/capacitaciones" class="menu-link">Capacitaciones</a></li>
        <li><a href="/evaluaciones_medicas" class="menu-link">Evaluaciones Médicas</a></li>
        <li><a href="/matriz_iper" class="menu-link">Matriz IPER</a></li>
        <li><a href="//control_epp" class="menu-link">Gestión EPP</a></li>
        <li><a href="/normas_legales" class="menu-link">Normas Legales</a></li>
        <li><a href="/firma_digital" class="menu-link">Firma Digital</a></li>
        <li><a href="/solicitudes_contrasena" class="menu-link">Solicitudes Contraseña</a></li>

        <li class="section-title">ADMINISTRACIÓN</li>
        <li><a href="/empresas" class="menu-link">Empresas</a></li>
        <li><a href="/usuarios" class="menu-link">Usuarios</a></li>
        <li><a href="/visualizacion_global" class="menu-link">Visualización Global</a></li>
        <li><a href="/formatos_globales" class="menu-link">Formatos Globales</a></li>
        <li><a href="/documentacion" class="menu-link">Documentación</a></li>

        <li class="section-title">GESTIÓN DE PERSONAL</li>
        <li><a href="/visualizacion_filtros" class="menu-link">Visualización y Filtros</a></li>
        <li><a href="/planes_accion" class="menu-link">Planes de Acción</a></li>
        <li><a href="/incidentes_accidentes" class="menu-link">Incidentes y Accidentes</a></li>
        <li><a href="/historial_cambios" class="menu-link">Historial de Cambios</a></li>
      </ul>
    </div>
    <!-- Contenido principal -->
    <div class="content flex-grow-1">
<div class="container mt-5">
    <h2 class="text-primary mb-4">Reporte General de EPP</h2>

    <!-- Formulario de búsqueda -->
    <form method="GET" class="row g-3 mb-4">
        <div class="col-md-4">
            <label for="tipoEpp" class="form-label">Tipo de EPP</label>
            <select class="form-select" id="tipoEpp" name="tipoEpp">
                <option value="Todos">Todos</option>
                <option value="Casco de seguridad">Casco de seguridad</option>
                <option value="Guantes de nitrilo">Guantes de nitrilo</option>
                <option value="Botas dieléctricas">Botas dieléctricas</option>
                <option value="Gafas de seguridad">Gafas de seguridad</option>
                <option value="Tapones auditivos">Tapones auditivos</option>
                <option value="Arnés de seguridad">Arnés de seguridad</option>
            </select>
        </div>

        <div class="col-md-3">
            <label for="fechaInicio" class="form-label">Desde</label>
            <input type="date" class="form-control" id="fechaInicio" name="fechaInicio">
        </div>

        <div class="col-md-3">
            <label for="fechaFin" class="form-label">Hasta</label>
            <input type="date" class="form-control" id="fechaFin" name="fechaFin">
        </div>

        <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Buscar</button>
        </div>
    </form>

    <!-- Dashboard de tarjetas resumen -->
    <div class="row text-center mb-4">
        <div class="col-md-3">
            <div class="card border-success shadow">
                <div class="card-body">
                    <h5 class="card-title text-success">Trabajadores</h5>
                    <p class="display-6">{{ resumen.trabajadores }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-primary shadow">
                <div class="card-body">
                    <h5 class="card-title text-primary">EPP Asignados</h5>
                    <p class="display-6">{{ resumen.epp_asignados }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-info shadow">
                <div class="card-body">
                    <h5 class="card-title text-info">Próximos a Vencer</h5>
                    <p class="display-6">{{ resumen.proximos_vencer }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-danger shadow">
                <div class="card-body">
                    <h5 class="card-title text-danger">Vencidos</h5>
                    <p class="display-6">{{ resumen.vencidos }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráfico de barras -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Distribución General de EPP</h5>
            <canvas id="graficoEPP" height="100"></canvas>
        </div>
    </div>

    <!-- Estado General -->
    <div class="alert alert-{{ 'success' if resumen.estado == 'OK' else 'warning' if resumen.estado == 'Atención' else 'danger' }}">
        <strong>Estado General:</strong> {{ resumen.estado }}
    </div>

    <!-- Botón volver -->
    <div class="mt-4 text-end">
        <a href="{{ url_for('control_epp') }}" class="btn btn-secondary">Volver</a>
    </div>
</div>

<!-- Script de gráfico -->
<script>
    const ctx = document.getElementById('graficoEPP').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Asignados', 'Vigentes', 'Próximos a Vencer', 'Vencidos'],
            datasets: [{
                label: 'Cantidad',
                data: [
                    {{ resumen.epp_asignados }},
                    {{ resumen.vigentes }},
                    {{ resumen.proximos_vencer }},
                    {{ resumen.vencidos }}
                ],
                backgroundColor: [
                    '#0d6efd',
                    '#198754',
                    '#ffc107',
                    '#dc3545'
                ],
                borderColor: [
                    '#0d6efd',
                    '#198754',
                    '#ffc107',
                    '#dc3545'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Cantidad'
                    },
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
</script>

</body>
</html>
